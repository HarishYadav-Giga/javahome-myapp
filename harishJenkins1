pipeline{
    agent any
        parameters {
      choice choices: ['master', 'dev', 'uat'], description: 'choose the branch to be build', name: 'BranchName'
      booleanParam defaultValue: false , description: 'would you like to skip the test?', name: 'SkipTests'
    }
    options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '10', numToKeepStr: '3')
}


    stages{
        stage("maven build"){
            when {
                expression{
                    params.BranchName =="dev"
            }
                }
            steps{
                script
                {
                    if (isUnix()){
                      sh "mvn clean package -DskipTests=${params.SkipTests}"
                    }
                }
            }
    }
        stage("Tomcat Deployment --Dev"){
            steps{
               sshagent(['tomcat-dev']) {
                // some block
                sh "scp -o StrictHostKeyChecking=no target/calculator.war ec2-user@172.31.8.242:/opt/tomcat8/webapps/"
                sh "ssh ec2-user@172.31.8.242 /opt/tomcat8/bin/startup.sh "
              } 
            }
            
        }
        }
post {
  always {
    // One or more steps need to be included within each condition's block.
    echo "clean workspace"
    cleanWs()
  }
  failure {
    // One or more steps need to be included within each condition's block.
    echo "send notification"
  }
}
}
